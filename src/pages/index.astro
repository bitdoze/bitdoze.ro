---
import Layout from "../layouts/Layout.astro";
import Hero from "../components/Hero.astro";
import Welcome from "../components/Welcome.astro";
import Services from "../components/Services.astro";
import Testimonials from "../components/Testimonials.astro";
import Portofoliu from "../components/Portofoliu.astro";
import CTA from "../components/CTA.astro";
import ServiceCardV2 from "../components/ServiceCardV2.astro";
import SectionHeader from "../components/SectionHeader.astro";
import TrustBadges from "../components/TrustBadges.astro";
import { Icon } from "astro-icon/components";

import { homePageConfig } from "../config/pages";
import { getCollection } from "astro:content";

// Extract sections from config
const heroSection = homePageConfig.sections.find(
  (section) => section.type === "hero"
);
const welcomeSection = homePageConfig.sections.find(
  (section) => section.type === "welcome"
);
const servicesSection = homePageConfig.sections.find(
  (section) => section.type === "services"
);
const testimonialsSection = homePageConfig.sections.find(
  (section) => section.type === "testimonials"
);
const portfolioSection = homePageConfig.sections.find(
  (section) => section.type === "portfolio"
);
const ctaSection = homePageConfig.sections.find(
  (section) => section.type === "cta"
);

// Get all non-draft services entries and sort by order
const servicii = await getCollection("servicii", ({ data }) => {
  return !data.draft;
});

// Sort by order field and limit to 3
const featuredServices = servicii
  .sort((a, b) => a.data.ordine - b.data.ordine)
  .slice(0, 3);
---

<Layout
  title={homePageConfig.title}
  description={homePageConfig.description}
  image={homePageConfig.ogImage}
>
  {
    welcomeSection && (
      <>
        <Welcome
          title={welcomeSection.title}
          subtitle={welcomeSection.subtitle}
          features={welcomeSection.features}
          ctas={welcomeSection.ctas}
          image={heroSection?.imageUrl || welcomeSection.image}
          badge={welcomeSection.badge}
          welcomeButtons={welcomeSection.ctas.welcome}
        />
        <div
          class="trust-badges-hero-section"
          style="background-color: var(--color-background-alt); padding: 3rem 0; margin-top: -2rem; border-bottom: 1px solid rgba(var(--color-text-lighter-rgb), 0.1);"
        >
          <div class="container">
            <TrustBadges variant="compact" />
          </div>
        </div>
      </>
    )
  }
  {
    servicesSection && (
      <section
        class="section-padding services-section"
        style="background: linear-gradient(180deg, var(--color-background-alt) 0%, var(--color-background) 100%);"
      >
        <div class="container">
          <div class="section-header-wrapper">
            <h2 class="section-title">
              <span class="title-gradient">Transformăm Ideile</span>
              <span class="title-text"> în Realitate Digitală</span>
            </h2>
            <p class="section-subtitle">
              Soluții profesionale complete, de la concept la implementare.
              <span class="highlight">
                Fără costuri ascunse, doar rezultate măsurabile.
              </span>
            </p>
          </div>

          <div class="services-grid">
            {featuredServices.map((service, index) => (
              <ServiceCardV2
                title={service.data.title}
                description={service.data.descriere}
                icon={service.data.icon}
                link={`/servicii/${service.slug}`}
                price={service.data.pret}
                index={index}
                badge={
                  index === 0
                    ? { text: "Popular", type: "popular" }
                    : index === 1
                    ? { text: "Recomandat", type: "recommended" }
                    : { text: "Nou", type: "new" }
                }
                ctaText="Află mai multe"
              />
            ))}
          </div>

          <div class="cta-wrapper">
            <a href="/servicii" class="view-all-btn">
              <span class="btn-text">Vezi Toate Serviciile</span>
              <Icon name="mdi:arrow-right" class="btn-icon" />
            </a>
          </div>
        </div>
      </section>
    )
  }

  {
    //  testimonialsSection && (
    //   <Testimonials
    //     title={testimonialsSection.title}
    //     subtitle={testimonialsSection.subtitle}
    //     testimonials={testimonialsSection.testimonials}
    //   />
    // )
  }

  {
    portfolioSection && (
      <Portofoliu
        title={portfolioSection.title}
        subtitle={portfolioSection.subtitle}
        ctaText={portfolioSection.cta?.text}
        ctaLink={portfolioSection.cta?.link}
      />
    )
  }

  {
    ctaSection && (
      <CTA
        title={ctaSection.title}
        subtitle={ctaSection.subtitle}
        ctaText={ctaSection.ctaPrimary.text}
        ctaLink={ctaSection.ctaPrimary.link}
        secondaryText={ctaSection.ctaSecondary?.text}
        secondaryLink={ctaSection.ctaSecondary?.link}
        trustedBy={ctaSection.trustedBy}
      />
    )
  }
</Layout>

<style>
  .trust-badges-hero-section {
    position: relative;
    z-index: 10;
    background: linear-gradient(
      to bottom,
      rgba(var(--color-background-alt-rgb), 0.5),
      var(--color-background-alt)
    );
  }

  :global(.dark) .trust-badges-hero-section {
    background: linear-gradient(
      to bottom,
      rgba(var(--color-dark-background-alt-rgb), 0.5),
      var(--color-dark-background-alt)
    );
  }

  /* Services Section Styles */
  .services-section {
    position: relative;
    overflow: hidden;
  }

  .services-section::before {
    content: "";
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(
      circle at 30% 70%,
      rgba(124, 58, 237, 0.05) 0%,
      transparent 50%
    );
    animation: float 20s ease-in-out infinite;
  }

  .services-section::after {
    content: "";
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(
      circle at 70% 30%,
      rgba(239, 68, 68, 0.05) 0%,
      transparent 50%
    );
    animation: float 25s ease-in-out infinite reverse;
  }

  @keyframes float {
    0%,
    100% {
      transform: translate(0, 0) rotate(0deg);
    }
    33% {
      transform: translate(30px, -30px) rotate(120deg);
    }
    66% {
      transform: translate(-20px, 20px) rotate(240deg);
    }
  }

  /* Section Header */
  .section-header-wrapper {
    text-align: center;
    margin-bottom: 4rem;
    position: relative;
    z-index: 1;
  }

  .section-title {
    font-size: clamp(2rem, 5vw, 3.5rem);
    font-weight: 900;
    line-height: 1.2;
    margin-bottom: 1.5rem;
    letter-spacing: -0.02em;
  }

  .title-gradient {
    background: linear-gradient(135deg, #7c3aed 0%, #ef4444 50%, #22c55e 100%);
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: gradientShift 8s ease infinite;
  }

  @keyframes gradientShift {
    0%,
    100% {
      filter: hue-rotate(0deg);
    }
    50% {
      filter: hue-rotate(30deg);
    }
  }

  .title-text {
    color: var(--color-text);
  }

  :global(.dark) .title-text {
    color: var(--color-dark-text);
  }

  .section-subtitle {
    font-size: 1.125rem;
    line-height: 1.7;
    color: var(--color-text-light);
    max-width: 700px;
    margin: 0 auto;
  }

  :global(.dark) .section-subtitle {
    color: var(--color-dark-text-light);
  }

  .section-subtitle .highlight {
    font-weight: 600;
    color: var(--color-primary);
  }

  /* Services Grid */
  .services-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
    position: relative;
    z-index: 1;
  }

  @media (min-width: 768px) {
    .services-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (min-width: 1024px) {
    .services-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  /* CTA Button */
  .cta-wrapper {
    text-align: center;
    position: relative;
    z-index: 1;
  }

  .view-all-btn {
    display: inline-flex;
    align-items: center;
    gap: 12px;
    padding: 16px 32px;
    background: linear-gradient(135deg, #7c3aed, #6d28d9);
    color: white;
    font-weight: 700;
    font-size: 16px;
    border-radius: 16px;
    text-decoration: none;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(124, 58, 237, 0.3);
  }

  .view-all-btn::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #6d28d9, #5b21b6);
    opacity: 0;
    transition: opacity 0.4s ease;
  }

  .view-all-btn:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 8px 30px rgba(124, 58, 237, 0.4);
  }

  .view-all-btn:hover::before {
    opacity: 1;
  }

  .btn-text {
    position: relative;
    z-index: 1;
    letter-spacing: 0.5px;
  }

  .btn-icon {
    position: relative;
    z-index: 1;
    width: 20px;
    height: 20px;
    transition: transform 0.3s ease;
  }

  .view-all-btn:hover .btn-icon {
    transform: translateX(4px);
  }

  /* Responsive adjustments */
  @media (max-width: 640px) {
    .section-header-wrapper {
      margin-bottom: 3rem;
    }

    .section-subtitle {
      font-size: 1rem;
    }

    .services-grid {
      gap: 1.5rem;
    }
  }
</style>
