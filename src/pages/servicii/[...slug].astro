---
import { getCollection, getEntry, type CollectionEntry } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import { Icon } from 'astro-icon/components';
import CTA from '../../components/CTA.astro';

export async function getStaticPaths() {
  const serviciiEntries = await getCollection('servicii');
  return serviciiEntries.map(entry => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

interface Props {
  entry: CollectionEntry<'servicii'>;
}

const { entry } = Astro.props;
const { Content } = await entry.render();

// Get all services for related services section
const allServices = await getCollection('servicii', ({ data }) => !data.draft);
// Filter out current service and get 3 random ones
const relatedServices = allServices
  .filter(service => service.slug !== entry.slug)
  .sort(() => Math.random() - 0.5)
  .slice(0, 3);

// Format price and duration nicely for display
const { title, descriere, icon, imagine, pret, durata, caracteristici, beneficii, intrebari_frecvente, seo } = entry.data;
---

<Layout 
  title={seo.title}
  description={seo.description}
  ogType="article"
>
  <!-- Hero Section -->
  <section class="section-padding relative overflow-hidden" style="background: linear-gradient(to bottom, rgba(79, 70, 229, 0.1), white);">
    <!-- Decorative elements -->
    <div class="absolute top-0 right-0 w-64 h-64 rounded-full opacity-20" style="background: radial-gradient(circle, var(--color-primary) 0%, transparent 70%);"></div>
    <div class="absolute bottom-0 left-0 w-48 h-48 rounded-full opacity-10" style="background: radial-gradient(circle, var(--color-accent) 0%, transparent 70%);"></div>
    
    <div class="container max-w-6xl relative z-10">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
        <div>
          <a href="/servicii" class="inline-flex items-center text-sm font-medium transition-all hover:-translate-x-1 mb-4" style="color: var(--color-primary);">
            <Icon name="mdi:arrow-left" class="mr-1.5 h-4 w-4" />
            Înapoi la servicii
          </a>
          <div class="flex items-center mb-4">
            <div class="inline-flex items-center justify-center w-14 h-14 mr-4 rounded-full" style="background-color: rgba(79, 70, 229, 0.1);">
              <Icon name={icon} class="h-7 w-7" style="color: var(--color-primary);" />
            </div>
            <h1 class="text-4xl md:text-5xl font-bold">{title}</h1>
          </div>
          <p class="text-xl mb-6" style="color: var(--color-text-light);">
            {descriere}
          </p>
          <div class="flex flex-wrap gap-4 mt-6">
            {pret && (
              <div class="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium" style="background-color: rgba(79, 70, 229, 0.1); color: var(--color-primary);">
                <Icon name="mdi:currency-usd" class="mr-1.5 h-4 w-4" />
                {pret}
              </div>
            )}
            {durata && (
              <div class="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium" style="background-color: rgba(79, 70, 229, 0.1); color: var(--color-primary);">
                <Icon name="mdi:clock-outline" class="mr-1.5 h-4 w-4" />
                {durata}
              </div>
            )}
          </div>
        </div>
        <div class="service-image-container">
          {imagine ? (
            <img 
              src={imagine} 
              alt={title} 
              class="w-full h-auto object-cover rounded-xl shadow-xl transform hover:scale-105 transition-transform duration-500"
              style="border-radius: var(--radius-xl);"
            />
          ) : (
            <div class="w-full aspect-video bg-gradient-to-r rounded-xl shadow-xl" style="background: linear-gradient(to right, var(--color-primary-light), var(--color-primary-dark)); border-radius: var(--radius-xl);"></div>
          )}
        </div>
      </div>
    </div>
  </section>

  <!-- Main Content Section -->
  <section class="section-padding">
    <div class="container max-w-6xl">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Main Content -->
        <div class="lg:col-span-2">
          <article class="prose prose-lg max-w-none" style="color: var(--color-text);">
            <Content />
          </article>

          <!-- FAQ Section -->
          {intrebari_frecvente && intrebari_frecvente.length > 0 && (
            <div class="mt-16">
              <h2 class="text-2xl font-bold mb-8 service-heading">Întrebări Frecvente</h2>
              <div class="space-y-6">
                {intrebari_frecvente.map((item, index) => (
                  <div class="faq-item p-6 rounded-lg" style="background-color: var(--color-background-alt); box-shadow: var(--shadow-sm); border: 1px solid rgba(0,0,0,0.05); border-radius: var(--radius-lg);">
                    <h3 class="text-lg font-semibold mb-3">{item.intrebare}</h3>
                    <p style="color: var(--color-text-light);">{item.raspuns}</p>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>

        <!-- Sidebar -->
        <div class="lg:col-span-1">
          <div class="sticky top-8 space-y-8">
            <!-- Características -->
            {caracteristici && caracteristici.length > 0 && (
              <div class="p-6 rounded-lg" style="background-color: var(--color-background-alt); box-shadow: var(--shadow-md); border: 1px solid rgba(0,0,0,0.05); border-radius: var(--radius-lg);">
                <h3 class="text-xl font-bold mb-4 flex items-center">
                  <Icon name="mdi:check-circle" class="mr-2 h-5 w-5" style="color: var(--color-primary);" />
                  Caracteristici
                </h3>
                <ul class="space-y-3">
                  {caracteristici.map(item => (
                    <li class="flex items-start">
                      <span class="inline-block mt-1 mr-2 text-sm" style="color: var(--color-primary);">●</span>
                      <span style="color: var(--color-text-light);">{item}</span>
                    </li>
                  ))}
                </ul>
              </div>
            )}

            <!-- Beneficios -->
            {beneficii && beneficii.length > 0 && (
              <div class="p-6 rounded-lg" style="background-color: var(--color-background-alt); box-shadow: var(--shadow-md); border: 1px solid rgba(0,0,0,0.05); border-radius: var(--radius-lg);">
                <h3 class="text-xl font-bold mb-4 flex items-center">
                  <Icon name="mdi:star" class="mr-2 h-5 w-5" style="color: var(--color-primary);" />
                  Beneficii
                </h3>
                <ul class="space-y-3">
                  {beneficii.map(item => (
                    <li class="flex items-start">
                      <span class="inline-block mt-1 mr-2 text-sm" style="color: var(--color-accent);">●</span>
                      <span style="color: var(--color-text-light);">{item}</span>
                    </li>
                  ))}
                </ul>
              </div>
            )}

            <!-- Navigation Box -->
            <div class="p-6 rounded-lg" style="background-color: var(--color-background-alt); box-shadow: var(--shadow-md); border: 1px solid rgba(0,0,0,0.05); border-radius: var(--radius-lg);">
              <h3 class="text-lg font-semibold mb-4">Explorează</h3>
              <ul class="space-y-3">
                <li>
                  <a href="/servicii" class="inline-flex items-center text-sm transition-all hover:translate-x-1" style="color: var(--color-primary);">
                    <Icon name="mdi:grid" class="mr-1.5 h-4 w-4" />
                    Toate serviciile
                  </a>
                </li>
                <li>
                  <a href="/portofoliu" class="inline-flex items-center text-sm transition-all hover:translate-x-1" style="color: var(--color-primary);">
                    <Icon name="mdi:folder-multiple" class="mr-1.5 h-4 w-4" />
                    Portofoliu
                  </a>
                </li>
                <li>
                  <a href="/contact" class="inline-flex items-center text-sm transition-all hover:translate-x-1" style="color: var(--color-primary);">
                    <Icon name="mdi:email" class="mr-1.5 h-4 w-4" />
                    Contactează-ne
                  </a>
                </li>
              </ul>
            </div>
            
            <!-- Contact Box -->
            <div class="p-6 rounded-lg" style="background: linear-gradient(to bottom right, var(--color-primary), var(--color-primary-dark)); box-shadow: var(--shadow-lg); color: white; border-radius: var(--radius-lg);">
              <h3 class="text-xl font-bold mb-4">Ai nevoie de acest serviciu?</h3>
              <p class="mb-6 text-white text-opacity-90">Contactează-ne acum pentru o consultație gratuită și o ofertă personalizată pentru afacerea ta.</p>
              <a 
                href="/contact" 
                class="block w-full py-3 px-4 text-center font-medium rounded-lg transition-transform hover:scale-105"
                style="background-color: white; color: var(--color-primary); border-radius: var(--radius-lg);"
              >
                Contactează-ne
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  
  <!-- Related Services -->
  <section class="section-padding" style="background-color: var(--color-background-alt);">
    <div class="container max-w-6xl">
      <h2 class="text-3xl font-bold mb-8 text-center service-heading">Alte servicii care te-ar putea interesa</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        {relatedServices.map(service => (
          <a href={`/servicii/${service.slug}`} class="service-card group">
            <div class="p-6 h-full flex flex-col rounded-lg transition-all duration-300 group-hover:-translate-y-2 group-hover:shadow-lg" style="background-color: var(--color-background); box-shadow: var(--shadow-sm); border: 1px solid rgba(0,0,0,0.05); border-radius: var(--radius-lg);">
              <div class="inline-flex items-center justify-center w-12 h-12 mb-4 rounded-full" style="background-color: rgba(79, 70, 229, 0.1);">
                <Icon name={service.data.icon} class="h-6 w-6" style="color: var(--color-primary);" />
              </div>
              <h3 class="text-xl font-bold mb-2 group-hover:text-primary transition-colors">{service.data.title}</h3>
              <p class="mb-4 flex-grow" style="color: var(--color-text-light);">{service.data.descriere}</p>
              <span class="inline-flex items-center text-sm font-medium transition-all group-hover:translate-x-1" style="color: var(--color-primary);">
                Află mai multe
                <Icon name="mdi:arrow-right" class="ml-1.5 h-4 w-4" />
              </span>
            </div>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- CTA Section with background decoration -->
  <section class="section-padding relative overflow-hidden" style="background: linear-gradient(to bottom right, var(--color-primary), var(--color-secondary-dark))">
    <div class="absolute inset-0 bg-grid opacity-20"></div>
    <div class="absolute -right-64 -top-64 w-96 h-96 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob" style="background-color: var(--color-secondary);"></div>
    <div class="absolute -left-64 -bottom-64 w-96 h-96 rounded-full mix-blend-multiply filter blur-3xl opacity-30" style="background-color: var(--color-primary-light);"></div>
    
    <div class="container relative z-10">
      <CTA 
        title="Pregătit să începem colaborarea?"
        subtitle="Contactează-ne astăzi pentru a discuta despre nevoile tale și a vedea cum serviciile noastre pot ajuta afacerea ta să crească."
        ctaText="Contactează-ne"
        ctaLink="/contact"
        secondaryText="Vezi toate serviciile"
        secondaryLink="/servicii"
      />
    </div>
  </section>
</Layout>

<style is:global>
  .prose h2 {
    color: var(--color-text);
    font-weight: 700;
    font-size: 1.75rem;
    margin-top: 2.5rem;
    margin-bottom: 1.25rem;
    position: relative;
    padding-left: 1rem;
  }
  
  .prose h2::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0.25rem;
    bottom: 0.25rem;
    width: 4px;
    background-color: var(--color-primary);
    border-radius: 2px;
  }
  
  .prose h3 {
    color: var(--color-text);
    font-weight: 600;
    font-size: 1.35rem;
    margin-top: 2rem;
    margin-bottom: 1rem;
  }
  
  .prose p {
    color: var(--color-text-light);
    margin-bottom: 1.25rem;
    line-height: 1.7;
  }
  
  .prose ul {
    color: var(--color-text-light);
    margin-bottom: 1.25rem;
    padding-left: 1.5rem;
  }
  
  .prose li {
    margin-bottom: 0.5rem;
  }

  .service-heading {
    position: relative;
    display: inline-block;
    margin-bottom: 1.5rem;
    padding-bottom: 0.75rem;
  }

  .service-heading::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 80px;
    height: 3px;
    background-color: var(--color-primary);
    border-radius: 3px;
  }
  
  .faq-item {
    transition: all 0.3s ease;
  }
  
  .faq-item:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow-md);
  }
  
  .service-card {
    transition: all 0.3s ease;
  }
  
  /* Background grid */
  .bg-grid {
    background-size: 40px 40px;
    background-image: 
      linear-gradient(to right, rgba(255, 255, 255, 0.1) 1px, transparent 1px),
      linear-gradient(to bottom, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
  }
  
  /* Blob animation */
  @keyframes animate-blob {
    0% {
      transform: translate(0px, 0px) scale(1);
    }
    33% {
      transform: translate(30px, -50px) scale(1.1);
    }
    66% {
      transform: translate(-20px, 20px) scale(0.9);
    }
    100% {
      transform: translate(0px, 0px) scale(1);
    }
  }
  
  .animate-blob {
    animation: animate-blob 7s ease-in-out infinite;
  }

  @media (max-width: 768px) {
    .prose h2 {
      font-size: 1.5rem;
    }
    
    .prose h3 {
      font-size: 1.25rem;
    }
  }
</style>